// ============================================================================
// WinuxCmd Integration Tests - Auto Generated
// Generated by scripts/generate_integration_tests.py
// DO NOT modify this file manually
// ============================================================================

#include "framework/winuxtest.h"

// ============================================================================
// Test Data Helper Functions
// ============================================================================

inline std::string get_sample_data() {
  return "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n";
}

inline std::string get_log_data() {
  return "[INFO] Starting process\n[ERROR] File not found\n[INFO] Retrying\n[ERROR] Timeout occurred\n[INFO] Completed\n";
}

inline std::string get_csv_data() {
  return "Alice,25,Engineer\nBob,30,Designer\nCharlie,28,Developer\n";
}

inline std::string get_numbered_data() {
  return "1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n";
}

inline std::string get_duplicate_data() {
  return "apple\napple\nbanana\nbanana\ncherry\napple\n";
}

inline std::string get_mixed_data() {
  return "hello\n123\nworld\n456\ntest\n";
}

// ============================================================================
// Two-Command Pipeline Tests
// ============================================================================


TEST(pipeline_2cmd, cat_to_head_basic_0) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_head_opt_1_none__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_head_opt_2_none__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_tail_basic_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_tail_opt_4_none__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_tail_opt_5_none__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_wc_basic_6) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_wc_opt_7_none__l) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_wc_opt_8_none__w) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-w"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_wc_opt_9_none__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_grep_basic_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_grep_opt_11_none_apple) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_grep_opt_12_none_banana) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"banana"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_grep_opt_13_none_ERROR) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"ERROR"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sort_basic_14) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sort_opt_15_none__r) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {L"-r"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sort_opt_16_none__n) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {L"-n"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sort_opt_17_none__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_uniq_basic_18) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"uniq.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_uniq_opt_19_none__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_uniq_opt_20_none__d) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"uniq.exe", {L"-d"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_uniq_opt_21_none__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"uniq.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_cut_basic_22) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_cut_opt_23_none__f_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_cut_opt_24_none__f_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_cut_opt_25_none__f_1_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1,2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sed_basic_26) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sed_opt_27_none_s_apple_APPLE_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sed_opt_28_none_s___PREFIX___) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/^/PREFIX: /"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_sed_opt_29_none_s_____SUFFIX_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/$/: SUFFIX/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_tee_basic_30) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tee.exe", {L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_tee_opt_31_none_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tee.exe", {L"output.txt", L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_tee_opt_32_none_tee_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tee.exe", {L"output.txt", L"tee_output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_xargs_basic_33) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"xargs.exe", {L"echo"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_xargs_opt_34_none_echo) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"xargs.exe", {L"echo", L"echo"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_xargs_opt_35_none__n_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"xargs.exe", {L"echo", L"-n", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_xargs_opt_36_none__P_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"xargs.exe", {L"echo", L"-P", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cat_basic_37) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cat.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cat output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cat_opt_38__n_3_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cat.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cat output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cat_opt_39__n_10_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cat.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cat output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_basic_40) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_41__n_3__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_42__n_3__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_43__n_3_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_44__n_10__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_45__n_10__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_46__n_10_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_47_none__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tail_opt_48_none__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_basic_49) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_50__n_3__l) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"wc.exe", {L"-l", L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_51__n_3__w) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"wc.exe", {L"-l", L"-w"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_52__n_3__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"wc.exe", {L"-l", L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_53__n_10__l) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"wc.exe", {L"-l", L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_54__n_10__w) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"wc.exe", {L"-l", L"-w"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_55__n_10__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"wc.exe", {L"-l", L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_56_none__l) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_57_none__w) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-w"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_wc_opt_58_none__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_basic_59) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_60__n_3_apple) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"grep.exe", {L"apple", L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_61__n_3_banana) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"grep.exe", {L"apple", L"banana"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_62__n_3_ERROR) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"grep.exe", {L"apple", L"ERROR"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_63__n_10_apple) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"grep.exe", {L"apple", L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_64__n_10_banana) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"grep.exe", {L"apple", L"banana"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_65__n_10_ERROR) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"grep.exe", {L"apple", L"ERROR"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_66_none_apple) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_67_none_banana) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"banana"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_grep_opt_68_none_ERROR) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"ERROR"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_basic_69) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_70__n_3__r) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sort.exe", {L"-r"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_71__n_3__n) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sort.exe", {L"-n"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_72__n_3__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sort.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_73__n_10__r) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sort.exe", {L"-r"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_74__n_10__n) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sort.exe", {L"-n"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_75__n_10__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sort.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_76_none__r) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {L"-r"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_77_none__n) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {L"-n"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sort_opt_78_none__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_basic_79) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_80__n_3__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_81__n_3__d) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"uniq.exe", {L"-d"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_82__n_3__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"uniq.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_83__n_10__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_84__n_10__d) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"uniq.exe", {L"-d"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_85__n_10__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"uniq.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_86_none__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_87_none__d) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {L"-d"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_uniq_opt_88_none__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_basic_89) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_90__n_3__f_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_91__n_3__f_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_92__n_3__f_1_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1,2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_93__n_10__f_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_94__n_10__f_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_95__n_10__f_1_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1,2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_96_none__f_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_97_none__f_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_cut_opt_98_none__f_1_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1,2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_basic_99) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_100__n_3_s_apple_APPLE_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_101__n_3_s___PREFIX___) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/^/PREFIX: /"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_102__n_3_s_____SUFFIX_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/$/: SUFFIX/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_103__n_10_s_apple_APPLE_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_104__n_10_s___PREFIX___) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/^/PREFIX: /"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_105__n_10_s_____SUFFIX_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/$/: SUFFIX/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_106_none_s_apple_APPLE_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_107_none_s___PREFIX___) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/^/PREFIX: /"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_sed_opt_108_none_s_____SUFFIX_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/$/: SUFFIX/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_basic_109) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"tee.exe", {L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_110__n_3_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"tee.exe", {L"output.txt", L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_111__n_3_tee_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"tee.exe", {L"output.txt", L"tee_output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_112__n_3_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"tee.exe", {L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_113__n_10_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"tee.exe", {L"output.txt", L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_114__n_10_tee_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"tee.exe", {L"output.txt", L"tee_output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_115__n_10_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"tee.exe", {L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_116_none_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"tee.exe", {L"output.txt", L"output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_tee_opt_117_none_tee_output_txt) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"tee.exe", {L"output.txt", L"tee_output.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tee output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_basic_118) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"xargs.exe", {L"echo"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_119__n_3_echo) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"xargs.exe", {L"echo", L"echo"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_120__n_3__n_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"xargs.exe", {L"echo", L"-n", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_121__n_3__P_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"xargs.exe", {L"echo", L"-P", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_122__n_10_echo) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"xargs.exe", {L"echo", L"echo"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_123__n_10__n_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"xargs.exe", {L"echo", L"-n", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_124__n_10__P_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"xargs.exe", {L"echo", L"-P", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_125_none_echo) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"xargs.exe", {L"echo", L"echo"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_126_none__n_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"xargs.exe", {L"echo", L"-n", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, head_to_xargs_opt_127_none__P_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"xargs.exe", {L"echo", L"-P", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> xargs output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cat_basic_128) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cat.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cat output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cat_opt_129__n_3_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cat.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cat output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cat_opt_130__n_10_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cat.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cat output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_basic_131) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_132__n_3__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_133__n_3__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_134__n_3_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_135__n_10__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_136__n_10__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_137__n_10_none) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_138_none__n_3) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"3"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_head_opt_139_none__n_10) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5", L"-n", L"10"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_basic_140) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_141__n_3__l) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"wc.exe", {L"-l", L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_142__n_3__w) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"wc.exe", {L"-l", L"-w"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_143__n_3__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"wc.exe", {L"-l", L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_144__n_10__l) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"wc.exe", {L"-l", L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_145__n_10__w) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"wc.exe", {L"-l", L"-w"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_146__n_10__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"wc.exe", {L"-l", L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_147_none__l) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_148_none__w) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-w"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_wc_opt_149_none__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"wc.exe", {L"-l", L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_basic_150) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_151__n_3_apple) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"grep.exe", {L"apple", L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_152__n_3_banana) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"grep.exe", {L"apple", L"banana"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_153__n_3_ERROR) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"grep.exe", {L"apple", L"ERROR"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_154__n_10_apple) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"grep.exe", {L"apple", L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_155__n_10_banana) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"grep.exe", {L"apple", L"banana"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_156__n_10_ERROR) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"grep.exe", {L"apple", L"ERROR"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_157_none_apple) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_158_none_banana) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"banana"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_grep_opt_159_none_ERROR) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"grep.exe", {L"apple", L"ERROR"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_basic_160) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_161__n_3__r) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sort.exe", {L"-r"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_162__n_3__n) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sort.exe", {L"-n"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_163__n_3__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sort.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_164__n_10__r) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sort.exe", {L"-r"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_165__n_10__n) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sort.exe", {L"-n"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_166__n_10__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sort.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_167_none__r) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {L"-r"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_168_none__n) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {L"-n"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sort_opt_169_none__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sort.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_basic_170) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_171__n_3__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_172__n_3__d) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"uniq.exe", {L"-d"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_173__n_3__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"uniq.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_174__n_10__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_175__n_10__d) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"uniq.exe", {L"-d"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_176__n_10__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"uniq.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_177_none__c) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_178_none__d) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {L"-d"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_uniq_opt_179_none__u_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"uniq.exe", {L"-u", L""});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> uniq output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_basic_180) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_181__n_3__f_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_182__n_3__f_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_183__n_3__f_1_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1,2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_184__n_10__f_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_185__n_10__f_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_186__n_10__f_1_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1,2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_187_none__f_1) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_188_none__f_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_cut_opt_189_none__f_1_2) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"cut.exe", {L"-f", L"1", L"-f", L"1,2"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cut output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_basic_190) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_191__n_3_s_apple_APPLE_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_192__n_3_s___PREFIX___) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/^/PREFIX: /"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_193__n_3_s_____SUFFIX_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"3"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/$/: SUFFIX/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_194__n_10_s_apple_APPLE_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_195__n_10_s___PREFIX___) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/^/PREFIX: /"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_196__n_10_s_____SUFFIX_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt", L"-n", L"10"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/$/: SUFFIX/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_197_none_s_apple_APPLE_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/apple/APPLE/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_198_none_s___PREFIX___) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/^/PREFIX: /"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_2cmd, tail_to_sed_opt_199_none_s_____SUFFIX_) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5", L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/", L"s/$/: SUFFIX/"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sed output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_head_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_head_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_head_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_head_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sort_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sort_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sort_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sort_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_tail_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tail -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_tail_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tail -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_tail_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tail -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_tail_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> tail -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_wc_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_wc_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_wc_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_wc_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_cat_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> cat -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_cat_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> cat -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_cat_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> cat -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_cat_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> cat -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_head_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> head -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_head_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> head -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_head_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> head -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_head_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> head -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_sort_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> sort -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_sort_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> sort -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_sort_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> sort -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_sort_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> sort -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_tail_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> tail -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_tail_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> tail -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_tail_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> tail -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_tail_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> tail -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_wc_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> wc -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_wc_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> wc -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_wc_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> wc -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, grep_to_wc_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("grep -> wc -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_cat_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cat -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_cat_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cat -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_cat_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cat -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_cat_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> cat -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_grep_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_grep_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_grep_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_grep_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> grep -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_sort_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_sort_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_sort_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_sort_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> sort -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_tail_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_tail_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_tail_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_tail_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> tail -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_wc_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_wc_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_wc_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, head_to_wc_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("head -> wc -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_cat_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> cat -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_cat_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> cat -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_cat_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> cat -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_cat_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> cat -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_grep_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> grep -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_grep_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> grep -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_grep_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> grep -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_grep_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> grep -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_head_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> head -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_head_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> head -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_head_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> head -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_head_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> head -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_tail_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> tail -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_tail_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> tail -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_tail_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> tail -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_tail_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> tail -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_wc_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> wc -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_wc_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> wc -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_wc_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> wc -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, sort_to_wc_to_tail) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"tail.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("sort -> wc -> tail output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_cat_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cat -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_cat_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cat -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_cat_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cat -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_cat_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> cat -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_grep_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_grep_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_grep_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_grep_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> grep -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_head_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_head_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_head_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_head_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"head.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> head -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_sort_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_sort_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_sort_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_sort_to_wc) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"sort.exe", {});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> sort -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_wc_to_cat) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"cat.exe", {L"input.txt"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc -> cat output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_wc_to_grep) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"grep.exe", {L"apple"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc -> grep output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_wc_to_head) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"head.exe", {L"-n", L"5"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc -> head output", r.stdout_text);
}

TEST(pipeline_3cmd, tail_to_wc_to_sort) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"tail.exe", {L"-n", L"5"});
  p.add(L"wc.exe", {L"-l"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("tail -> wc -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_wc_log_errors) {
  TempDir tmp;
  tmp.write("log.txt", "[INFO] Starting process\n[ERROR] File not found\n[INFO] Retrying\n[ERROR] Timeout occurred\n[INFO] Completed\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"ERROR"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sort_to_uniq_sort_uniq_count) {
  TempDir tmp;
  tmp.write("data.txt", "apple\napple\nbanana\nbanana\ncherry\napple\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  p.add(L"uniq.exe", {L"-c"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort -> uniq output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_cut_csv_extract) {
  TempDir tmp;
  tmp.write("employees.csv", "Alice,25,Engineer\nBob,30,Designer\nCharlie,28,Developer\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"Engineer"});
  p.add(L"cut.exe", {L"-d", L",", L"-f", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> cut output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_sort_grep_sort) {
  TempDir tmp;
  tmp.write("data.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"apple"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_wc_grep_wc) {
  TempDir tmp;
  tmp.write("data.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"banana"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sort_to_uniq_sort_reverse_uniq) {
  TempDir tmp;
  tmp.write("data.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {L"-r"});
  p.add(L"uniq.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort -> uniq output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sort_to_uniq_long_pipeline) {
  TempDir tmp;
  tmp.write("large.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sort.exe", {});
  p.add(L"uniq.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sort -> uniq output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_grep_to_wc_multi_filter) {
  TempDir tmp;
  tmp.write("multi_grep.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"grep.exe", {L"a"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep -> wc output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_sed_to_sort_sed_sort) {
  TempDir tmp;
  tmp.write("transform.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"sed.exe", {L"s/apple/APPLE/"});
  p.add(L"sort.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> sed -> sort output", r.stdout_text);
}

TEST(pipeline_3cmd, cat_to_head_to_wc_head_wc) {
  TempDir tmp;
  tmp.write("numbers.txt", "1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {L"input.txt"});
  p.add(L"head.exe", {L"-n", L"3"});
  p.add(L"wc.exe", {L"-l"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_wc_empty_data) {
  TempDir tmp;
  tmp.write("empty.txt", "");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {});
  p.add(L"wc.exe", {});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> wc output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_head_single_line) {
  TempDir tmp;
  tmp.write("single.txt", "single_line\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {});
  p.add(L"head.exe", {L"-n", L"1"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> head output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_grep_no_match) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {});
  p.add(L"grep.exe", {L"xyz123"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep output", r.stdout_text);
}

TEST(pipeline_2cmd, cat_to_grep_case_insensitive) {
  TempDir tmp;
  tmp.write("input.txt", "apple\nbanana\ncherry\ndate\nelderberry\nfig\ngrape\n");
  Pipeline p;
  p.set_cwd(tmp.wpath());
  p.add(L"cat.exe", {});
  p.add(L"grep.exe", {L"-i", L"APPLE"});
  auto r = p.run();
  EXPECT_EXIT_CODE(r, 0);
  TEST_LOG("cat -> grep output", r.stdout_text);
}

// ============================================================================
// Test Statistics
// ============================================================================
// Total generated: 314 test cases
// ============================================================================
